<!DOCTYPE HTML>
    <html>
        <head>
            <title>Dinero</title>
            <meta name="author" content="David Cho">
            <meta name="description" content="database to track of foreign currency">    
            <link href="/static/css/bootstrap.css" rel="stylesheet" media="screen">
            <link href="/static/css/stylesheet.css"rel="stylesheet" type="text/css">
            <script src="/static/js/jquery-1.8.2.js"></script>
            <script src="/static/js/bootstrap.js"></script>
            <script src="/static/js/knockout-2.3.0.js"></script>

            <script>
                function ViewModel() {
                    var self = this;
                    self.currency = ko.observable('');
                    self.denomination = ko.observable('');
                    self.quantity = ko.observable('');
                }

                $(document).ready(function() {
                    $('#add').popover({
                        placement: 'right',
                        trigger: 'hover'
                    });
                });

                function addError(id, text_id, text) {
                    var $start = $(id);
                    $start.addClass("has-error");
                    $(text_id).val('');
                    $(text_id).attr("placeholder", text);
                }
                function removeError(id) {
                    var $start = $(id);
                    $start.removeClass("has-error");
                }
                function validate() {
                    var currency = $('#currency').val();
                    var denom = $('#denom').val();
                    var quantity = $('#quantity').val();

                    var letters = /[\d]/;
                    var numbers = /^[0-9]+$/;

                    if (currency == '')
                        addError('#group1', '#currency', 'Missing currency');
                    else if (letters.test(currency))
                        addError('#group1', '#currency', 'Invalid currency');
                    else
                        removeError('#group1');

                    if (denom == '')
                        addError('#group2', '#denom', 'Missing denom');
                    else if (!numbers.test(denom))
                        addError('#group2', '#denom', 'Invalid denom');
                    else
                        removeError('#group2');
                        
                    if (quantity == '')
                        addError('#group3', '#quantity', 'Missing quantity')
                    else if (!numbers.test(quantity))
                        addError('#group3', '#quantity', 'Invalid quantity')
                    else
                        removeError('#group3');

                    console.log("1 " + $('#group1').hasClass('has-error'));
                    console.log("2 " + $('#group2').hasClass('has-error'));
                    console.log("3 " + $('#group3').hasClass('has-error'));

                    return !($('#group1').hasClass('has-error') || $('#group2').hasClass('has-error') || $('#group2').hasClass('has-error'));
                }
            </script>
        </head>
        <body>
            <img src="/static/images/map.jpg" id="background">
            
            <div id="wrap">
                <div id="main" class="container">
                    <div id="search-box">
                        <form id="search-form" action="/search" method="get">
                            <input type="text" id="s" name="q" value="Search..." onfocus='if (this.value == "Search...") {this.value = ""}' onblur='if (this.value == "") {this.value = "Search...";}'/>
                            <input type="image" src="/static/images/blank.gif" id="sbutton" />
                        </form>
                    </div>
                    <div id="container-wrap">
                        <div id="container">
                            <div id="title">
                                Foreign Currency Database
                            </div>
                            <table class="zebra">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Currency</th>
                                        <th>Denomination</th>
                                        <th>Quantity</th>
                                    </tr>
                                </thead>
                            </table>
                            <table class="zebra">
                                <tbody>
                                    {% for entry in entries %}
                                    <tr>
                                        <td>{{forloop.counter}}</td>
                                        <td>{{entry.country}}</td>
                                        <td>{{entry.denomination}}</td>
                                        <td>{{entry.quantity}}</td>
                                    </tr>
                                    {% endfor %}
                            </table>
                        </div>
                    </div>
                    <form id="inputs" class="form-inline" method="post">{% csrf_token %}
                        <div id="group1">
                            <input type="text" data-bind="value: currency" id="currency" class="form-control input-small" placeholder="Currency" name="country" {%if errors.country%}value="Invalid currency"{%endif%}>
                        </div>
                        <div id="group2">
                            <input type="text" data-bind="value: denomination" id="denom" class="form-control input-small" placeholder="Denomination" name="denomination" {%if errors.country%}value="Invalid currency"{%endif%}>
                        </div>
                        <div id="group3">
                            <input type="text" data-bind="value: quantity" id="quantity" class="form-control input-small" placeholder="Quantity" name="quantity" {%if errors.country%}value="Invalid currency"{%endif%}>
                        </div>
                        <!-- <input type="submit" class="btn btn-info" value="+" id="add" onclick="return validate();" name="submit" rel="popover" title="help" data-content="this is help"> -->
                        <input type="submit" class="btn btn-info" value="+" id="add" onclick="return validate();" name="submit">
                    </form>
                    <div id="edit">
                        <a data-toggle="modal" href="#edit-modal" class="btn btn-default btn-small">edit raw file</a>
                        <div class="modal fade" id="edit-modal">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        <h4><span id="modal-header">Edit database file</span></h4>
                                    </div>
                                    <form method="post">{% csrf_token %}
                                        <div class="modal-body" id="modal-body">
                                            <textarea name="text" class="form-control" rows="15">{{rawtext}}</textarea>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary" name="save-changes">Save changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="float: left; color: red;">
                        <p>Currency: <span data-bind="text: currency"></span></p>
                        <p>Denomination: <span data-bind="text: denomination"></span></p>
                        <p>Quantity: <span data-bind="text: quantity"></span></p>
                    </div>
                </div>
            </div>

            <div id="footer">
                <p>Designed and built by David Cho</p>
            </div>

            <script>ko.applyBindings(new ViewModel());</script>

<script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>
        </body>
    </html>